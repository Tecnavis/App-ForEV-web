

<!-- API Key :AIzaSyARf6Of6YPvTIvQLYECPGGHofzLYxJjN4k -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Direction</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #map {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            z-index: -1; /* Ensure the map is behind other elements */
        }
        #inputs {
            position: absolute;
            top: 80%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 1; /* Ensure the inputs are above the map */
        }
        input[type="text"] {
            width: 80%;
            padding: 10px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            outline: none;
        }
        button {
            background-color: #2c8de8;
            color: white;
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0e61af;
        }
    </style>
</head>
<body>
    <div id="inputs">
        <button id="nearbyEVS">Show the Nearby EV Stations</button><br>
        <p>or</p>
        <input type="text" id="origin-input" placeholder="Enter current location">
        <input type="text" id="destination-input" placeholder="Enter destination"><br>
        <button id="navigateButton">Show the Inroute EV Stations</button>
        <!-- <button id="openMapsButton">Open in Maps</button><br> -->
        <a href="list.html" target="_blank"><button>List of EV stations</button> </a>
    </div>
    <div id="map"></div>

    <script>
        function initMap() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var map = new google.maps.Map(document.getElementById('map'), {
                        center: {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        },
                        zoom: 15,
                        mapTypeControl: false, // Remove map type control
                        fullscreenControl: false, // Remove fullscreen control
                        streetViewControl: false // Remove street view control
                    });
                    
                    var directionsService = new google.maps.DirectionsService;
                    var directionsDisplay = new google.maps.DirectionsRenderer({
                        map: map
                    });
                    
                    var originInput = document.getElementById('origin-input');
                    var destinationInput = document.getElementById('destination-input');
                    var navigateButton = document.getElementById('navigateButton');
                    var nearbyEVSButton = document.getElementById('nearbyEVS');
                    var openMapsButton = document.getElementById('openMapsButton');
                    var markers = []; // Array to store markers
                    
                    var originAutocomplete = new google.maps.places.Autocomplete(originInput);
                    var destinationAutocomplete = new google.maps.places.Autocomplete(destinationInput);
                    
                    function calculateAndDisplayRoute() {
                        directionsService.route({
                            origin: originInput.value,
                            destination: destinationInput.value,
                            travelMode: 'DRIVING'
                        }, function(response, status) {
                            if (status === 'OK') {
                                directionsDisplay.setDirections(response);
                                var start = originInput.value;
                                var end = destinationInput.value;
                                navigateButton.href = "list.html?start=" + encodeURIComponent(start) + "&end=" + encodeURIComponent(end);
                                
                                // Call function to display EV stations along the route
                                displayEVStationsAlongRoute(response.routes[0].overview_path, map);
                            } else {
                                window.alert('Directions request failed due to ' + status);
                            }
                        });
                    }

                    function displayEVStationsAlongRoute(path, map) {
                        // Clear existing markers
                        markers.forEach(function(marker) {
                            marker.setMap(null);
                        });
                        markers = [];

                        // Loop through the route path and get EV stations within a radius at each point
                        path.forEach(function(point) {
                            var request = {
                                location: point,
                                radius: 50, // 5 m radius
                                keyword: 'ev station'
                            };

                            var service = new google.maps.places.PlacesService(map);
                            service.nearbySearch(request, function(results, status) {
                                if (status === google.maps.places.PlacesServiceStatus.OK) {
                                    results.forEach(function(place) {
                                        // Add a marker for each EV station found
                                        var marker = new google.maps.Marker({
                                            map: map,
                                            position: place.geometry.location,
                                            title: place.name
                                        });
                                        markers.push(marker); // Add marker to the array
                                    });
                                }
                            });
                        });
                    }

                    navigateButton.addEventListener('click', function() {
                        calculateAndDisplayRoute();
                    });

                    nearbyEVSButton.addEventListener('click', function() {
                        // Clear existing markers
                        markers.forEach(function(marker) {
                            marker.setMap(null);
                        });
                        markers = [];

                        // Retrieve current location
                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition(function(position) {
                                var currentLocation = {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude
                                };

                                // Perform nearby search for EV stations
                                var request = {
                                    location: currentLocation,
                                    radius: 10000, // 10 km radius
                                    keyword: 'ev station'
                                };

                                var service = new google.maps.places.PlacesService(map);
                                service.nearbySearch(request, function(results, status) {
                                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                                        results.forEach(function(place) {
                                            // Add a marker for each EV station found
                                            var marker = new google.maps.Marker({
                                                map: map,
                                                position: place.geometry.location,
                                                title: place.name
                                            });
                                            markers.push(marker); // Add marker to the array
                                        });
                                    }
                                });
                            });
                        }
                    });

                    openMapsButton.addEventListener('click', function() {
                        var start = originInput.value;
                        var end = destinationInput.value;
                        var mapsUrl = "https://www.google.com/maps/dir/?api=1&origin=" + encodeURIComponent(start) + "&destination=" + encodeURIComponent(end) + "&travelmode=driving";
                        window.open(mapsUrl, '_blank');
                    });
                });
            }
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARf6Of6YPvTIvQLYECPGGHofzLYxJjN4k&libraries=places&callback=initMap" async defer></script>
</body>
</html>
